<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="fragments/page">

<body class="ccPayment">

<!--/* No nav dropdown for this page */-->
<div layout:fragment="nav"></div>

<div class="container" layout:fragment="bodyContent">
    <div class="row-fluid" th:object="${paymentInfo}">

        <div class="col-sm-1"></div>

        <div class="col-sm-5">

            <form action="#" th:action="${postURL}" method="post" class="form-secondary" th:object="${paymentInfo}"
                  id="ccPaymentForm">

                <th:block th:if="${paymentInfo.giftCodesOnly == true}">
                    <p class="secondary">Coming soon!</p>
                </th:block>

                <th:block th:unless="${paymentInfo.giftCodesOnly == true}">

                    <!--/* Stripe */-->

                    <th:block th:if="${StripeJavaScript}">

                        <div class="page-header">
                            <h1>Billing</h1>
                        </div>

                        <div th:utext="${StripeJavaScript}">
                            <script src="https://checkout.stripe.com/checkout.js"
                                    class="stripe-button"
                                    data-key=""
                                    data-amount="2500"
                                    data-name="One Personal Cloud"
                                    data-description="$25 USD"
                                    data-image="img/cloud.png">
                            </script>
                        </div>

                    </th:block>

                    <!--/* SagePay */-->

                    <th:block th:if="${SagePay}">

                        <div class="page-header">
                            <h1>Billing Information</h1>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-6">
                                <input type="text" class="form-control" id="BillingFirstNames" name="BillingFirstNames"
                                       required="required" placeholder="first name" autofocus="autofocus"/>
                            </div>
                            <div class="form-group col-sm-6">
                                <input type="text" class="form-control" id="BillingSurname" name="BillingSurname"
                                       required="required" placeholder="last name"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingAddress1" name="BillingAddress1"
                                   required="required" placeholder="address line 1"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingAddress2" name="BillingAddress2"
                                   placeholder="address line 2"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingCity" name="BillingCity"
                                   required="required" placeholder="city"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingState" name="BillingState"
                                   required="required" placeholder="state/province/region"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingPostCode" name="BillingPostCode"
                                   required="required" placeholder="zip/postcode"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="BillingCountry" name="BillingCountry"
                                   required="required" placeholder="country"/>
                        </div>

                    </th:block>

                    <!--/* BrainTree */-->

                    <th:block th:if="${BrainTree}">

                        <div class="page-header">
                            <h1>Credit Card Details</h1>
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="number" name="number"
                                   required="required" placeholder="credit card number" data-encrypted-name="number" autofocus="autofocus"/>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="cvv" name="cvv"
                                       required="required" size="4" placeholder="cvv" data-encrypted-name="cvv"/>
                            </div>
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="month" name="month"
                                       required="required" size="2" placeholder="mm"/>
                            </div>
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="year" name="year"
                                       required="required" size="4" placeholder="yyy"/>
                            </div>
                        </div>

                        <script src="https://js.braintreegateway.com/v1/braintree.js"></script>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var bt = /*[[${BrainTree}]]*/ null;
                            var brainTree = Braintree.create(bt);
                            brainTree.onSubmitEncryptForm('ccPaymentForm');
                            /*]]>*/
                        </script>

                    </th:block>

                    <!--/* PinNetAu */-->

                    <th:block th:if="${PinNetAu}">

                        <div class="page-header">
                            <div class="form-control-feedback has-error" id="pinNetAuError">
                                <h3></h3>
                                <ul style="text-align: left;"></ul>
                            </div>

                            <h1>Credit Card Details</h1>
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="cc-number" name="cc-number"
                                   required="required" placeholder="credit card number" autofocus="autofocus"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="cc-name" name="cc-name"
                                   required="required" placeholder="name on card"/>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="cvv" name="cvv"
                                       required="required" size="4" placeholder="cvv"/>
                            </div>
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="month" name="month"
                                       required="required" size="2" placeholder="mm"/>
                            </div>
                            <div class="form-group col-sm-4">
                                <input type="text" class="form-control" autocomplete="off" id="year" name="year"
                                       required="required" size="4" placeholder="yyyy"/>
                            </div>
                        </div>

                        <h1>Card Billing Address</h1>

                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="address-line1" name="address-line1"
                                   required="required" placeholder="address line 1"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="address-line2" name="address-line2"
                                   placeholder="address line 2"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="address-city" name="address-city"
                                   required="required" placeholder="city"/>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-7">
                                <input type="text" class="form-control" autocomplete="off" id="address-state" name="address-state"
                                       required="required" placeholder="state"/>
                            </div>
                            <div class="form-group col-sm-5">
                                <input type="text" class="form-control" autocomplete="off" id="address-postcode" name="address-postcode"
                                       required="required" placeholder="postcode"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" autocomplete="off" id="address-country" name="address-country"
                                   required="required" placeholder="country"/>
                        </div>

                        <script src="https://cdn.pin.net.au/pin.v2.js"></script>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            // 1. Wait for the page to load
                            $(function () {

                                // 2. Create an API object with your publishable api key, and
                                // specifying 'test' or 'live'.
                                //
                                // Be sure to use your live publishable key with the live api, and
                                // your test publishable key with the test api.
                                var publishableKey = /*[[${publishableKey}]]*/ 'your publishable key';
                                var environment = /*[[${environment}]]*/ 'test';
                                var pinApi = new Pin.Api(publishableKey, environment);

                                var form = $('#ccPaymentForm');
                                var submitButton = form.find(':submit');
                                var errorContainer = form.find('#pinNetAuError');
                                var errorList = errorContainer.find('ul');
                                var errorHeading = errorContainer.find('h3');

                                // 3. Add a submit handler to the form which calls Pin.js to
                                // retrieve a card token, and then add that token to the form and
                                // submit the form to your server.
                                form.submit(function (e) {
                                    e.preventDefault();

                                    // Clear previous errors
                                    errorList.empty();
                                    errorHeading.empty();
                                    errorContainer.hide();

                                    // Disable the submit button to prevent multiple clicks
                                    submitButton.attr({disabled: true});

                                    // Fetch details required for the createToken call to Pin Payments
                                    var card = {
                                        number: $('#cc-number').val(),
                                        name: $('#cc-name').val(),
                                        expiry_month: $('#month').val(),
                                        expiry_year: $('#year').val(),
                                        cvc: $('#cvv').val(),
                                        address_line1: $('#address-line1').val(),
                                        address_line2: $('#address-line2').val(),
                                        address_city: $('#address-city').val(),
                                        address_state: $('#address-state').val(),
                                        address_postcode: $('#address-postcode').val(),
                                        address_country: $('#address-country').val()
                                    };

                                    // Request a token for the card from Pin Payments
                                    pinApi.createCardToken(card).then(handleSuccess, handleError).done();
                                });

                                function handleSuccess(card) {
                                    // Add the card token to the form
                                    //
                                    // Once you have the card token on your server you can use your
                                    // private key and Charges API to charge the credit card.
                                    $('<input>').attr({type: 'hidden', name: 'card_token'}).val(card.token).appendTo(form);

                                    // Resubmit the form to the server
                                    //
                                    // Only the card_token will be submitted to your server. The
                                    // browser ignores the original form inputs because they don't
                                    // have their 'name' attribute set.
                                    form.get(0).submit();
                                }

                                function handleError(response) {
                                    errorHeading.text(response.error_description);

                                    if (response.messages) {
                                        $.each(response.messages, function (index, paramError) {
                                            $('<li>').text(paramError.message).appendTo(errorList);
                                        });
                                    }

                                    errorContainer.show();

                                    // Re-enable the submit button
                                    submitButton.removeAttr('disabled');
                                }
                            });
                            /*]]>*/

                        </script>
                    </th:block>

                    <th:block th:unless="${StripeJavaScript}">
                        <button type="submit" name="submitBtn" id="submitBtn" class="button btn btn-lg btn-primary">Continue</button>
                    </th:block>

                    <input type="hidden" name="numberOfClouds" value="" id="numberOfClouds" th:value="*{numberOfClouds}"/>
                    <input type="hidden" name="txnType" value="" id="txnType" th:value="*{txnType}"/>
                    <input type="hidden" name="amount" value="" id="amount" th:value="${amount}"/>

                </th:block>
            </form>

        </div>

        <div class="col-sm-1"></div>

        <!--/* Order summary */-->
        <div class="col-sm-4">
            <div class="page-header" id="orderSummary">
                <h1>Order summary</h1>
            </div>

            <div class="equation">
                <div class="addend">
                    Respect Network<br/>
                    LIFETIME membership
                </div>
                <div class="plus">+</div>
                <div class="addend">
                    LIFETIME Base<br/>
                    Cloud hosting
                </div>
                <div class="equals" th:text="${totalAmountText}"> $xx USD</div>
            </div>
        </div>

    </div>
</div>

<th:block layout:fragment="postFooterContent"></th:block>

</body>
</html>
